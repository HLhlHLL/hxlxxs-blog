import{E as k}from"./md-editor-v3.es.b94cfe84.js";import{c as B}from"./generator.b4402241.js";import{d as U,r as p,w as G,b as l,c as u,h as e,k as D,u as F,F as j,e as I,g as r,t as d,E as L,i as q,p as z,l as H,_ as J}from"./index.daa6cca7.js";import{t as K}from"./shared.ddb0cd84.js";const i=_=>(z("data-v-bece5349"),_=_(),H(),_),M={class:"comments animate__animated animate__fadeIn"},O={class:"editor"},P={class:"submit"},Q=i(()=>e("div",{class:"avatar"},[e("img",{src:"https://gravatar.loli.net/avatar/d41d8cd98f00b204e9800998ecf8427e?d=mp&v=1.5.1"})],-1)),W={class:"comment-main"},X={class:"user-box"},Y={class:"username"},Z={class:"c-meta"},ee={class:"c-content"},se={class:"action-box"},te=["onClick"],oe=i(()=>e("i",{class:"iconfont icon-liuyan"},null,-1)),ae=i(()=>e("span",{class:"reply-text"},"\u56DE\u590D",-1)),ne={key:0,class:"subEditor"},ce={class:"submit"},le=["onClick"],ue={class:"sub-item"},ie=i(()=>e("div",{class:"sub-avatar"},[e("img",{src:"https://gravatar.loli.net/avatar/d41d8cd98f00b204e9800998ecf8427e?d=mp&v=1.5.1"})],-1)),de={class:"sub-main"},me={class:"sub-user-box"},re={class:"sub-user"},_e=i(()=>e("div",{class:"sub-username"},"anonymous",-1)),pe={key:0,class:"reply-to"},he=["attr"],ve={class:"sub-content"},be={class:"sub-action-box"},Ce=["onClick"],fe=i(()=>e("i",{class:"iconfont icon-liuyan"},null,-1)),ge=i(()=>e("span",{class:"liuyan-count"},"\u56DE\u590D",-1)),ye=[fe,ge],we={key:0,class:"subEditor"},Ae={class:"submit"},ke=["onClick"],Be={key:1,class:"blank"},De=i(()=>e("span",null,"\u6682\u65F6\u6CA1\u6709\u66F4\u591A\u8BC4\u8BBA",-1)),Fe=[De],Ee=U({__name:"index",props:{comment:null,article:null,page:null},setup(_){const n=_,E=L(),m=q("global"),N=p(["=","preview"]),h=p(""),g=p(""),v=p(""),b=p("");let S;const y=async(s,t)=>{const o=E.params.aid||"";let a;!s&&!t?(a=B(o,h.value),w(a),g.value=a.comid,h.value="",n.comment.unshift(a)):s&&!t?(a=B(o,v.value,s.comid),w(a),g.value=a.comid,v.value="",s.subComments.unshift(a),s.showSubComment=!1,C=""):s&&t&&(a=B(o,b.value,s.comid),w(a),g.value=a.comid,a.to=S,b.value="",s.subComments.push(a),t.showSubComment=!1,f="")},w=async s=>{try{n.article?(await m.$http.put(`/api/1.1/classes/contentArticle/${n.article.objectId}`,{comment:{__op:"Add",objects:[s]}}),await m.$http.put(`/api/1.1/classes/articles/${E.params.objectId}`,{comment:{__op:"Add",objects:[s]}})):!n.article&&n.page&&(n.page==="about"&&await m.$http.put("/api/1.1/classes/comments/6344220d318a6c5d6f03e232",{aboutComment:{__op:"Add",objects:[s]}}),n.page==="comment"&&await m.$http.put("/api/1.1/classes/comments/6344220d318a6c5d6f03e232",{comment:{__op:"Add",objects:[s]}})),m.$message({message:"\u8BC4\u8BBA\u6210\u529F\u54AF\uFF01\uFF01",type:"success"})}catch{m.$message({message:"\u51FA\u4E86\u70B9\u9519\u8BEF\uFF0C\u8BC4\u8BBA\u5931\u8D25\uFF01\uFF01",type:"danger"})}};let C="";const R=s=>{n.comment.forEach(t=>{t.showSubComment=!1}),C!==s.comid?(s.showSubComment=!s.showSubComment,C=s.comid):C=""};let f="";const T=(s,t)=>{S=s,n.comment[t].subComments.forEach(o=>{o.showSubComment=!1}),f!==s.comid?(s.showSubComment=!s.showSubComment,f=s.comid):f=""},x=s=>{s.forEach(t=>{const o=new Date(t.createdAt).getTime();t.timeAgo=K(new Date().getTime()-o),t.subComments&&x(t.subComments)})};return G(()=>n.comment,()=>{x(n.comment)},{deep:!0}),(s,t)=>(l(),u("div",M,[e("div",O,[D(F(k),{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=o=>h.value=o),style:{height:"200px"},placeholder:"\u6B22\u8FCE\u5728\u8BC4\u8BBA\u533A\u7559\u8A00",toolbars:N.value},null,8,["modelValue","toolbars"]),e("div",P,[e("button",{class:"submit-button",onClick:t[1]||(t[1]=o=>y())},"\u53D1\u8868\u8BC4\u8BBA")])]),n.comment.length>0?(l(!0),u(j,{key:0},I(n.comment,(o,a)=>{var $;return l(),u("div",{class:"comment-item",key:o.comid},[Q,e("div",W,[e("div",X,[e("div",Y,d(o.userName||"anonymous"),1),e("div",Z,d(o.timeAgo+""),1)]),e("div",ee,d(o.content),1),e("div",se,[e("span",{class:"reply",onClick:c=>R(o)},[e("span",null,[oe,e("span",null,d(($=o.subComments)==null?void 0:$.length),1)]),ae],8,te)]),o.showSubComment?(l(),u("div",ne,[D(F(k),{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=c=>v.value=c),style:{height:"150px"},placeholder:"\u56DE\u590D",toolbars:["=","preview"]},null,8,["modelValue"]),e("div",ce,[e("button",{class:"submit-button",onClick:c=>y(o)}," \u56DE\u590D ",8,le)])])):r("",!0),o.subComments.length>0?(l(!0),u(j,{key:1},I(o.subComments,c=>{var V;return l(),u("div",{class:"sub-comments",key:c.comid},[e("div",ue,[ie,e("div",de,[e("div",me,[e("div",re,[_e,(V=c.to)!=null&&V.userName?(l(),u("span",pe,d("\u56DE\u590D "+c.to.userName),1)):r("",!0)]),e("div",{class:"sub-meta",attr:new Date},d(c.timeAgo),9,he)]),e("div",ve,d(c.content),1),e("div",be,[e("span",{class:"liuyan",onClick:A=>T(c,a)},ye,8,Ce)]),c.showSubComment?(l(),u("div",we,[D(F(k),{modelValue:b.value,"onUpdate:modelValue":t[3]||(t[3]=A=>b.value=A),style:{height:"150px",width:"750px"},placeholder:"\u56DE\u590D",toolbars:["=","preview"]},null,8,["modelValue"]),e("div",Ae,[e("button",{class:"submit-button",onClick:A=>y(o,c)}," \u56DE\u590D ",8,ke)])])):r("",!0)])])])}),128)):r("",!0)])])}),128)):r("",!0),n.comment.length===0?(l(),u("div",Be,Fe)):r("",!0)]))}});const je=J(Ee,[["__scopeId","data-v-bece5349"]]);export{je as C};
