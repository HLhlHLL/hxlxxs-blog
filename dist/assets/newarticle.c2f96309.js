import{d as S,r as v,w as G,O as F,b as y,c as C,h as e,t as A,J as B,P as D,n as P,F as N,e as L,p as O,l as H,_ as k,Q as X,g as Y,f as Z,H as ee,j as te,i as q,a as ae,o as se,x as oe,k as I,u as j,E as le,R as ce}from"./index.daa6cca7.js";import{E as ue}from"./md-editor-v3.es.b94cfe84.js";import{v as R,a as ne}from"./generator.b4402241.js";import{m as ie}from"./shared.ddb0cd84.js";const M=g=>(O("data-v-8a93a5d2"),g=g(),H(),g),re={class:"category-selector"},de={class:"selector-lv1"},ve={class:"selected"},ge=M(()=>e("span",null,"\u4E00\u7EA7\u5206\u7C7B\uFF1A",-1)),pe={class:"selected-value"},_e={class:"hide"},he=["placeholder"],me=M(()=>e("i",{class:"iconfont icon-next category"},null,-1)),ye=[me],Ce={class:"selector"},Fe=["onClick"],Ee={class:"selector-lv2"},$e={class:"selected"},fe=M(()=>e("span",null,"\u4E8C\u7EA7\u5206\u7C7B\uFF1A",-1)),Ae={class:"selected-value"},Be={class:"hide"},De=["placeholder","disabled"],be=S({__name:"index",props:{placeholder:{default:""},categories:null,currentCategory:null},emits:["handleValueChange"],setup(g,{expose:u,emit:h}){const l=g,o=v(""),s=v(""),a=v([]),n=i=>{i===1&&o.value!==void 0?a.value[0]={categoryName:o.value,cid:R()}:i===2&&a.value[0]!==void 0&&(a.value[1]={cid:R(),pid:a.value[0].cid,categoryName:s.value}),h("handleValueChange",a.value)},r=v(!0),E=i=>{o.value=i.categoryName,i.isExist=!0,a.value[0]=i,h("handleValueChange",a.value),F.to(".selector",{top:-20,opacity:0,height:0,duration:.5,ease:"power.out"}),r.value=!r.value},$=()=>{r.value=!r.value,r.value?F.to(".selector",{top:-20,opacity:0,height:0,duration:.5,ease:"power.out"}):F.to(".selector",{top:0,opacity:1,height:160,duration:.5,ease:"power.in"})};return G(()=>l.currentCategory,i=>{if(i.pid){const t=l.categories.find(d=>d.cid===i.pid);o.value=(t==null?void 0:t.categoryName)||"",s.value=i.categoryName}else o.value=i.categoryName}),document.addEventListener("click",function(i){i.target.className!=="selector-item"&&i.target.className!=="iconfont icon-next category"&&!r.value&&(F.to(".selector",{top:-20,opacity:0,height:0,duration:.5,ease:"power.out"}),r.value=!r.value)}),u({restSelector:()=>{o.value="",s.value="",a.value=[]},getSelectorValues:()=>{h("handleValueChange",a.value),console.log(a.value)}}),(i,t)=>(y(),C("div",re,[e("div",de,[e("div",ve,[ge,e("div",pe,[e("span",_e,A(o.value||l.placeholder),1),B(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=d=>o.value=d),placeholder:l.placeholder,onChange:t[1]||(t[1]=d=>n(1))},null,40,he),[[D,o.value,void 0,{trim:!0}]])]),e("div",{class:P(["selector-button",r.value?"":"rotating"]),onClick:$},ye,2)]),e("ul",Ce,[(y(!0),C(N,null,L(l.categories,d=>(y(),C("li",{class:"selector-item",key:d.cid,onClick:m=>E(d)},A(d.categoryName),9,Fe))),128))])]),e("div",Ee,[e("div",$e,[fe,e("div",Ae,[e("span",Be,A(s.value||l.placeholder),1),B(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=d=>s.value=d),placeholder:o.value?"\u8BF7\u8F93\u5165\u81EA\u5B9A\u4E49\u5206\u7C7B\u540D\u79F0":"\u8BF7\u5148\u9009\u62E9\u4E00\u7EA7\u5206\u7C7B",disabled:!o.value,onChange:t[3]||(t[3]=d=>n(2))},null,40,De),[[D,s.value,void 0,{trim:!0}]])])])])]))}});const we=k(be,[["__scopeId","data-v-8a93a5d2"]]),xe={key:0,class:"tag"},Te={class:"content"},Ne=S({__name:"index",emits:["handleCLoseTag"],setup(g,{emit:u}){const h=v(!1),l=()=>{h.value=!0,u("handleCLoseTag")};return(o,s)=>h.value?Y("",!0):(y(),C("span",xe,[e("span",Te,[X(o.$slots,"default",{},void 0,!0)]),e("i",{class:"iconfont icon-close",onClick:l})]))}});const Se=k(Ne,[["__scopeId","data-v-e7c3b01a"]]),U=g=>(O("data-v-8ec744c8"),g=g(),H(),g),ke={class:"add-tags"},Ve={class:"selector-box"},Ie={class:"selected"},Le={class:"selected-value"},Re={class:"hide"},Oe=["placeholder"],He=U(()=>e("i",{class:"iconfont icon-next tag"},null,-1)),Me=[He],Ue=U(()=>e("i",{class:"iconfont icon-plus"},null,-1)),je=U(()=>e("span",null,"\u6DFB\u52A0",-1)),Ge=[Ue,je],Pe={class:"tag-selector"},qe=["onClick"],Je={class:"tags"},ze=S({__name:"index",props:{tags:null,placeholder:null,currentTags:null},emits:["handleTagChange"],setup(g,{expose:u,emit:h}){const l=g,o=q("global"),s=v(""),a=v([]),n=v(!0),r=v(!1),E=()=>{if(!s.value)return o.$message({message:"\u6807\u7B7E\u4E0D\u80FD\u4E3A\u7A7A",type:"warning"});a.value.every(t=>t.tagName!==s.value)?(a.value.push({tagName:s.value,tid:R(),isExist:r.value}),r.value=!1,s.value="",h("handleTagChange",a.value)):(s.value="",o.$message({message:"\u4E0D\u80FD\u91CD\u590D\u6DFB\u52A0",type:"warning"}))},$=()=>{n.value=!n.value,n.value?F.to(".tag-selector",{top:-20,opacity:0,height:0,duration:.5,ease:"power.out"}):F.to(".tag-selector",{top:0,opacity:1,height:160,duration:.5,ease:"power.in"})},w=t=>{a.value=a.value.filter(d=>d!==t)},x=t=>{s.value=t.tagName,r.value=!0,F.to(".tag-selector",{top:-20,opacity:0,height:0,duration:.5,ease:"power.out"}),n.value=!n.value};return document.addEventListener("click",function(t){t.target.className!=="selector-item"&&t.target.className!=="iconfont icon-next tag"&&!n.value&&(F.to(".tag-selector",{top:-20,opacity:0,height:0,duration:.5,ease:"power.out"}),n.value=!n.value)}),G(()=>l.currentTags,t=>{a.value=t||[]}),u({resetTag:()=>{s.value="",a.value=[]}}),(t,d)=>(y(),C(N,null,[e("div",ke,[e("div",Ve,[e("div",Ie,[e("div",Le,[e("span",Re,A(s.value||l.placeholder),1),B(e("input",{type:"text","onUpdate:modelValue":d[0]||(d[0]=m=>s.value=m),placeholder:l.placeholder},null,8,Oe),[[D,s.value,void 0,{trim:!0}]])]),e("div",{class:P(["selector-button",n.value?"":"rotating"]),onClick:$},Me,2),e("span",{class:"add-tag-button",onClick:E},Ge)]),e("ul",Pe,[(y(!0),C(N,null,L(l.tags,m=>(y(),C("li",{class:"selector-item",key:m.tid,onClick:V=>x(m)},A(m.tagName),9,qe))),128))])])]),e("ul",Je,[(y(!0),C(N,null,L(a.value,m=>(y(),Z(Se,{key:m.tid,onHandleCloseTag:V=>w(m)},{default:ee(()=>[te(A(m.tagName),1)]),_:2},1032,["onHandleCloseTag"]))),128))])],64))}});const Qe=k(ze,[["__scopeId","data-v-8ec744c8"]]),We=[{cid:"5F6CBF8D-59E1-28E0-9DEF-CF9F362FD360",categoryName:"\u524D\u7AEF"},{cid:"09E35CAA-4D03-4731-0BE6-B2D017AAB362",categoryName:"JavaScript"},{cid:"F9F3DC04-65C5-2FA4-B9AA-586361BE3603",categoryName:"HTML"},{cid:"8FFC154C-882C-D5C5-A854-47DF3EB29B7A",categoryName:"CSS"},{cid:"7080B86F-C3A4-ED91-E27C-0B93CA7E9E2D",categoryName:"Vue"},{cid:"1367E7D2-F23E-7FE3-A84A-24A2A40D4BE9",categoryName:"React"},{cid:"79A6F1E8-95F3-54B5-EC47-0D7353B1E7BF",categoryName:"vue-router"},{cid:"5BE4181A-309A-7BF7-5D4F-FE0FF3EBDD43",categoryName:"Pinia"}],b=g=>(O("data-v-6544485f"),g=g(),H(),g),Ke={class:"new-article animate__animated animate__fadeIn"},Xe={class:"title"},Ye=b(()=>e("div",{class:"text"},"\u6807\u9898",-1)),Ze={class:"content"},et=b(()=>e("div",{class:"content-title"},"\u6B63\u6587",-1)),tt={class:"abstract"},at=b(()=>e("div",{class:"abstract-title"},"\u6458\u8981",-1)),st={class:"category"},ot=b(()=>e("div",{class:"category-title"},"\u6DFB\u52A0\u5206\u7C7B",-1)),lt={class:"tags"},ct=b(()=>e("div",{class:"tags-title"},"\u6DFB\u52A0\u6807\u7B7E",-1)),ut={class:"actions"},nt={key:0,class:"actions-add"},it={key:1,class:"actions-edit"},rt=S({__name:"newarticle",setup(g){const u=q("global"),h=le(),l=ae({article:{}}),o=v(""),s=v(""),a=v(""),n=v([]),r=v([]),E=v([]),$=v([]),w=c=>{n.value=c},x=c=>{r.value=c},i=v(null),t=v(null),d=()=>{i.value&&i.value.resetTag(),t.value&&t.value.restSelector(),o.value="",a.value="",s.value="",n.value=[],r.value=[]},m=async()=>{if(!(o.value&&a.value&&s.value&&n.value&&r.value))return u.$message({message:"\u8BF7\u5148\u5B8C\u5584\u6587\u7AE0\u4FE1\u606F",type:"warning"});const{article:c,tags:_,categories:p,contentArticle:T}=ne(o.value,a.value,s.value,n.value,r.value);try{await u.$http.post("/api/1.1/classes/articles",{...c}),await u.$http.post("/api/1.1/classes/contentArticle",{...T}),await u.$http.post("/api/1.1/batch",{requests:p.map(f=>({method:"POST",path:"/1.1/classes/categories",body:{...f}}))}),await u.$http.post("/api/1.1/batch",{requests:_.map(f=>({method:"POST",path:"/1.1/classes/tags",body:{...f}}))}),u.$message({message:"yes\uFF0C\u53D1\u5E03\u6210\u529F\uFF01\uFF01",type:"success"})}catch{u.$message({message:"\u7B49\u7B49\uFF0C\u597D\u50CF\u51FA\u4E86\u70B9\u5C0F\u95EE\u9898...",type:"danger"})}finally{d()}},V=async()=>{const c=l.article,_=o.value,p=s.value,T=a.value,f=n.value.length===2?n.value[1]:n.value[0]||c.category,W=r.value||c.tags,K=h.params.objectId;try{await u.$http.put(`/api/1.1/classes/contentArticle/${c.objectId}`,{title:_,content:p,abstract:T,category:f,tags:W,meta:{visitedTimes:c.meta.visitedTimes,wordCount:p.length,costTime:Math.floor(p.length/400)||1}}),await u.$http.put(`/api/1.1/classes/articles/${K}`,{title:_,content:p,abstract:T,meta:{visitedTimes:c.meta.visitedTimes,wordCount:p.length,costTime:Math.floor(p.length/400)||1}}),ce.push({name:"home"}),u.$message({message:"\u4FEE\u6539\u6210\u529F\u54AF\uFF01\uFF01",type:"success"})}catch{u.$message({message:"\u4FEE\u6539\u51FA\u4E86\u70B9\u5C0F\u5DEE\u9519\uFF01\uFF01",type:"danger"})}},J=async()=>{const{data:c}=await u.$http.get("/api/1.1/classes/categories");E.value=ie(We,c.results)},z=async()=>{const{data:c}=await u.$http.get("/api/1.1/classes/tags");$.value=c.results};se(()=>{J(),z()});const Q=async c=>{const{data:_}=await u.$http.get(`/api/1.1/classes/contentArticle?where={"aid": "${c}"}`);l.article=_.results[0],o.value=l.article.title,s.value=l.article.content,a.value=l.article.abstract};return oe(()=>{const c=h.params.aid;c&&Q(c)}),(c,_)=>(y(),C("div",Ke,[e("div",Xe,[Ye,B(e("input",{type:"text","onUpdate:modelValue":_[0]||(_[0]=p=>o.value=p)},null,512),[[D,o.value]])]),e("div",Ze,[et,I(j(ue),{modelValue:s.value,"onUpdate:modelValue":_[1]||(_[1]=p=>s.value=p)},null,8,["modelValue"])]),e("div",tt,[at,B(e("textarea",{rows:"5",name:"abstract","onUpdate:modelValue":_[2]||(_[2]=p=>a.value=p)},null,512),[[D,a.value]])]),e("div",st,[ot,I(we,{ref_key:"categorySelectorRef",ref:t,categories:E.value,currentCategory:l.article.category,placeholder:"\u8BF7\u9009\u62E9\u5206\u7C7B\u6216\u6DFB\u52A0\u81EA\u5B9A\u4E49\u5206\u7C7B\u540D\u79F0",onHandleValueChange:w},null,8,["categories","currentCategory"])]),e("div",lt,[ct,I(Qe,{ref_key:"tagGroupRef",ref:i,placeholder:"\u6DFB\u52A0\u6807\u7B7E",tags:$.value,currentTags:l.article.tags,onHandleTagChange:x},null,8,["tags","currentTags"])]),e("div",ut,[j(h).params.aid?(y(),C("div",it,[e("button",{class:"edit",onClick:V},"\u786E\u8BA4\u4FEE\u6539")])):(y(),C("div",nt,[e("button",{class:"reset",onClick:d},"\u91CD\u7F6E"),e("button",{class:"submit",onClick:m},"\u63D0\u4EA4")]))])]))}});const ht=k(rt,[["__scopeId","data-v-6544485f"]]);export{ht as default};
