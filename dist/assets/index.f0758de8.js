import{d as T,b as u,f as F,k as B,H as Y,T as H,I as G,J as V,K as U,h as t,t as d,_ as Z,L as J,r as v,a as D,x as K,c as _,g as C,s as A,F as q,e as O,E as Q,M as w,m as W,i as X}from"./index.daa6cca7.js";import{P as ee}from"./index.8592fcbc.js";import{u as te}from"./articles.efae0f2b.js";const ae={class:"message-box"},se={class:"message-box-inner"},oe={class:"title"},ne={class:"content"},ie={class:"footer"},le=T({__name:"index",props:{modelValue:{type:Boolean,default:!1},title:{default:"message box"},content:{default:"this is some message"},cancelButtonText:{default:"cancel"},confirmButtonText:{default:"confirm"}},emits:["update:modelValue","handleCancel","handleConfirm"],setup(h,{emit:r}){const n=h,m=()=>{r("handleCancel"),r("update:modelValue",!n.modelValue)},g=()=>{r("handleConfirm"),r("update:modelValue",!n.modelValue)};return(b,s)=>(u(),F(G,{to:"body"},[B(H,null,{default:Y(()=>[V(t("div",ae,[t("div",se,[t("div",oe,[t("span",null,d(n.title),1)]),t("div",ne,[t("span",null,d(n.content),1)]),t("div",ie,[t("button",{class:"cancel",onClick:m},d(n.cancelButtonText),1),t("button",{class:"confirm",onClick:g},d(n.confirmButtonText),1)])])],512),[[U,n.modelValue]])]),_:1})]))}});const ce=Z(le,[["__scopeId","data-v-8b4d7b40"]]),de={class:"article-list"},re={class:"article-list-content"},ue={key:0,class:"payload"},_e={key:0,class:"category-name"},pe={class:"year"},me=["onClick"],$e={class:"item-content"},ve={class:"item-meta"},he={class:"item-title"},ge={class:"actions"},ye=["onClick"],fe=["onClick"],xe={class:"footer"},Ce=T({__name:"index",props:{payload:null},setup(h){const r=h,n=Q(),m=W(),g=te(),b=J(),s=X("global"),a=v(new Date().getFullYear()),$=v([]),l=D({label:n.params.tag||n.params.category||"",tid:n.params.tid,cid:n.params.cid}),y=v(),f=v(!1),P=e=>{sessionStorage.getItem("sessionToken")!==b.sessionToken&&e.remove()},I=e=>{m.push({name:"newarticle",params:{aid:e.aid,objectId:e.objectId}})},S=e=>{f.value=!0,y.value=e},z=()=>{s.$message({message:"\u53D6\u6D88\u4E86\u5220\u9664\u64CD\u4F5C",type:"info"})},E=async()=>{try{await s.$http.delete(`/api/1.1/classes/articles/${y.value.objectId}`);const{data:e}=await s.$http.get(`/api/1.1/classes/contentArticle?where={"aid": "${y.value.aid}"}`),o=e.results[0];await s.$http.delete(`/api/1.1/classes/contentArticle/${o.objectId}`),p(),s.$message({message:"\u5220\u9664\u6210\u529F\uFF01\uFF01",type:"success"})}catch{s.$message({message:"\u5220\u9664\u5931\u8D25\uFF01\uFF01",type:"danger"})}},i=D({total:0,size:5,range:3,currentPage:1}),M=e=>{i.currentPage=e,p()},j=e=>{const o=g.articleList.findIndex(c=>c.aid===e.aid);m.push({name:"article",params:{aid:e.aid,index:o}})},L=()=>{a.value-=1,p(),x()},N=()=>{a.value+=1,p(),x()},x=async()=>{if(l.tid){const{data:e}=await s.$http.get(`/api/1.1/classes/articles?where={"$and":[{"tid": "${l.tid}"},{"createdAt":{"$gte":{"__type":"Date","iso":"${a.value}-01-01T00:00:00.000Z"},"$lt":{"__type":"Date","iso":"${a.value+1}-01-01T00:00:00.000Z"}}}]}&limit=0&count=1`);i.total=e.count}else if(l.cid){const{data:e}=await s.$http.get(`/api/1.1/classes/articles?where={"$and":[{"cid": "${l.cid}"},{"createdAt":{"$gte":{"__type":"Date","iso":"${a.value}-01-01T00:00:00.000Z"},"$lt":{"__type":"Date","iso":"${a.value+1}-01-01T00:00:00.000Z"}}}]}&limit=0&count=1`);i.total=e.count}else{const{data:e}=await s.$http.get(`/api/1.1/classes/articles?where={"createdAt":{"$gte":{"__type":"Date","iso":"${a.value}-01-01T00:00:00.000Z"},"$lt":{"__type":"Date","iso":"${a.value+1}-01-01T00:00:00.000Z"}}}&limit=0&count=1`);i.total=e.count}},p=async()=>{const e=i.currentPage>1?(i.currentPage-1)*i.size:0;if(l.tid){const{data:o}=await s.$http.get(`/api/1.1/classes/articles?where={"$and":[{"tid": "${l.tid}"},{"createdAt":{"$gte":{"__type":"Date","iso":"${a.value}-01-01T00:00:00.000Z"},"$lt":{"__type":"Date","iso":"${a.value+1}-01-01T00:00:00.000Z"}}}]}&order=-createdAt&limit=${i.size}&skip=${e}`);$.value=o.results}else if(l.cid){const{data:o}=await s.$http.get(`/api/1.1/classes/articles?where={"$and":[{"cid": "${l.cid}"},{"createdAt":{"$gte":{"__type":"Date","iso":"${a.value}-01-01T00:00:00.000Z"},"$lt":{"__type":"Date","iso":"${a.value+1}-01-01T00:00:00.000Z"}}}]}&order=-createdAt&limit=${i.size}&skip=${e}`);$.value=o.results}else{const{data:o}=await s.$http.get(`/api/1.1/classes/articles?where={"createdAt":{"$gte":{"__type":"Date","iso":"${a.value}-01-01T00:00:00.000Z"},"$lt":{"__type":"Date","iso":"${a.value+1}-01-01T00:00:00.000Z"}}}&order=-createdAt&limit=${i.size}&skip=${e}`);$.value=o.results}};return K(()=>{p(),x()}),(e,o)=>(u(),_("div",de,[t("div",re,[r.payload?(u(),_("div",ue,[t("span",null,d(r.payload),1),l.label?(u(),_("span",_e,d(l.label),1)):C("",!0)])):C("",!0),t("div",pe,[t("span",{class:"current-year",style:A({fontSize:r.payload?"24px":"30px"})},d(a.value),5),t("div",{class:"year-selector"},[t("i",{class:"iconfont icon-previous",onClick:L}),t("i",{class:"iconfont icon-next",onClick:N})])]),(u(!0),_(q,null,O($.value,(c,R)=>(u(),_("div",{class:"list-item",style:A({animationDelay:`${R*.1}s`}),key:c.aid,onClick:k=>j(c)},[t("div",$e,[t("div",ve,d(e.dateFormat(c.createdAt).format("MM-DD")),1),t("div",he,d(c.title),1)]),V((u(),_("div",ge,[t("button",{class:"edit-button",onClick:w(k=>I(c),["stop"])}," \u7F16\u8F91 ",8,ye),t("button",{class:"remove-button",onClick:w(k=>S(c),["stop"])}," \u5220\u9664 ",8,fe)])),[[P]])],12,me))),128))]),t("div",xe,[i.total>5?(u(),F(ee,{key:0,"button-color":"#222",pagination:i,onGetCurrentPage:M},null,8,["pagination"])):C("",!0)]),B(ce,{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=c=>f.value=c),title:"\u8FD9\u662F\u4E00\u6761\u63D0\u793A",content:"\u662F\u5426\u786E\u8BA4\u5220\u9664","cancel-button-text":"\u53D6\u6D88","confirm-button-text":"\u786E\u5B9A",onHandleCancel:z,onHandleConfirm:E},null,8,["modelValue"])]))}});const Ae=Z(Ce,[["__scopeId","data-v-501517d0"]]);export{Ae as A};
